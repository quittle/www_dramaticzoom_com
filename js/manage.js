var ar=new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded",{async:true});function imgReload(el,count){if(count===undefined){count=4}if(count<=0){el.style.height=style(el,"width",true)}else{(function(c){setTimeout(function(){el.src=el.src+"";el.onerror=imgReload(el,c-1)},100)})(count)}}showLogin=(function(orig){return function(){orig.apply(showLogin,arguments);ar.send({method:"getEmail"},function(ret){var r=parseInt(ret);if(r!="NaN"||r>=0){document.getElementById("manage-prompt").style.display="none";document.getElementById("manage-real").style.display="";document.getElementById("reset-email").setAttribute("placeholder",ret)}});ar=new AjaxRequest("/php/manage-zooms.php","get","application/x-www-form-urlencoded",{async:true});ar.send({method:"getZooms"},function(ret){var ret=ret.split("\n");var zooms=document.getElementById("zoomographs");zooms.innerHTML="";for(var i=0;i<ret.length;i++){if(ret[i]!=""){var r=ret[i].split(",");var zDetail=genEl("div",{"class":"zoomography-detail "+(i%2==0?"left":"right")});var zLink=genEl("a",{"class":"zoomography-link",href:"http://drzm.co/"+r[0]});var zImg=genEl("img",{"class":"zoomography-img",src:r[1],onerror:"imgReload(this)"});(function(e){e.addEventListener("load",function(){e.removeAttribute("width");e.removeAttribute("height")});setTimeout(function(){e.src=e.src+""},1)})(zImg);zLink.appendChild(zImg);zDetail.appendChild(zLink);var zShare=genEl("input",{"class":"zoomography-share",type:"text",readOnly:"readOnly",value:"drzm.co/"+r[0]});(function(id){zShare.addEventListener("click",function(){this.value="http://drzm.co/"+id;this.select()});zShare.addEventListener("blur",function(){this.value="drzm.co/"+id})})(r[0]);zDetail.appendChild(zShare);var zInfo=genEl("div",{"class":"zoomography-info"});var zCount=genEl("div",{"class":"zoomography-views"},null,"Views: "+parseInt(r[2]));var zDel;(function(id,zDetail){zDel=genEl("div",{"class":"button zoomography-delete"},{},"Delete");zDel.onclick=function(){deleteZoomograph(id,zDetail)}})(r[0],zDetail);var clearFix=genEl("div",{"class":"clearfix"});zInfo.appendChild(zCount);zInfo.appendChild(zDel);zInfo.appendChild(clearFix);zDetail.appendChild(zInfo);zooms.appendChild(zDetail)}}zooms.appendChild(genEl("div",{"class":"clearfix"}))})}})(showLogin);function submitChangePassword(form){var orig=form["reset-orig"].value;var pass1=form["reset-password1"].value;var pass2=form["reset-password2"].value;if(orig==""){alert("Your current password is empty")}else{if(pass1==""||pass2==""){alert("Your new password cannot be empty")}else{if(pass1!=pass2){alert("Your passwords don't match")}else{if(pass1==orig){alert("Your new password is the same as your old one")}else{new AjaxRequest("/php/manage-password.php","post","application/x-www-form-urlencoded",{async:true}).send({method:"reset-known",password:Sha256.hash(orig),newPassword:Sha256.hash(pass1)},function(ret){ret=parseInt(ret);if(ret==0){alert("Password successfully changed");form["reset-orig"].value=form["reset-password1"].value=form["reset-password2"].value="";checkpass("reset-password1","reset-password2")}else{if(ret==-1){alert("Error: There was an error processing your request")}else{if(ret==-2){alert("Error: Password unchanged.  Perhaps you mistyped your current password")}else{alert("Error ("+ret+"): Unknown Error")}}}})}}}}return false}function submitChangeEmail(form){var email=form["reset-email"].value;if(email==""){alert("Email is empty")}if(!emailRegexPattern.test(email)){alert("Email is not valid")}else{new AjaxRequest("/php/manage-email.php","post","application/x-www-form-urlencoded",{async:true}).send({method:"reset-known",email:email},function(ret){ret=parseInt(ret);if(ret==0){alert("Email successfully changed");form["reset-email"].setAttribute("placeholder",email);form["reset-email"].value=""}else{if(ret==-1){alert("Invalid submission")}else{if(ret==-2){alert("Email address already taken")}else{alert("Error ("+ret+"): Unknown Error")}}}})}return false}function deleteZoomograph(id,zDetail){ar.send({method:"delZoom",id:id},function(ret){if(ret=="1"){zDetail.style.opacity=0}else{alert("There was a problem deleting your zoomograph\nError:"+ret)}})};
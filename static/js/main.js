var drops;var emailRegexPattern=/^[?!_\.\-0-9a-zA-Z]+@[-0-9a-zA-Z]+(\.[0-9a-zA-Z]+)+$/;var isMobile;window.addEventListener("load",function(){var mobileDetector=document.getElementById("mobile-detector");if(parseInt(style(mobileDetector,"width"))>0&&parseInt(style(mobileDetector,"height"))>0){isMobile=true;var head=document.head;head.appendChild(genEl("script",{src:"/js/mobile.js?"+Math.random(),async:"async"}));if(window.jLoc){head.appendChild(genEl("script",{src:"/js/m."+jLoc+".js?"+Math.random(),async:"async"}))}}drops=document.getElementsByClassName("drop");for(var i=0;i<drops.length;i++){drops[i].appendChild(genEl("a",{"class":"drop-close",onclick:function(){showDrop()}},{},"Close"))}initDrops();initAlert();var c=getCookie("login");if(c){new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded",{async:true}).send({method:"getUser"},function(ret){if(parseInt(ret)<0){alert("You are now logged out");remCookie("login")}else{showLogin(ret)}})}});window.addEventListener("resize",function(){if(!drops){drops=document.getElementsByClassName("drop")}var adjusted;for(var i=0;i<drops.length;i++){if(drops[i].style.top!="-3px"){putClass(drops[i],"secret");drops[i].style.top="-9999px";drops[i].style.top=-1*(parseInt(style(drops[i],"height"))+6+40)+"px";remClass(drops[i],"secret")}else{adjustSections(drops[i]);adjusted=true}}if(!adjusted){adjustSections()}});function initDrops(){for(var i=0;i<drops.length;i++){var drop=drops[i];drop.style.top=-1*(parseInt(style(drop,"height"))+6+40)+"px"}}function initAlert(){alertMessage.style.left=-1*(parseInt(style(alertMessage,"width"))+6+30)+"px"}function adjustSections(drop){var alertMessage=document.getElementById("alertMessage");var dropContainer=document.getElementById("drop-container");var section=document.getElementsByClassName("section")[0];var dy=drop?drop.offsetHeight-3:0;if(section){if(alertMessage.style.left=="-3px"&&absoluteLeft(section)<(alertMessage.offsetWidth+25)){dy=Math.max(absoluteTop(alertMessage)+alertMessage.offsetHeight,dy)}}dy=Math.max(dy+25-absoluteTop(dropContainer),0);dropContainer.style.height=dy+"px"}function loginSubmit(){var user=document.getElementById("login-user").value.toLowerCase();var passElem=document.getElementById("login-pass");var pass=Sha256.hash(passElem.value);passElem.value="";login(user,pass);return false}function login(user,pass){new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded").send({method:"login",user:user,pass:pass},function(ret){if(parseInt(ret)<0){alert("Incorrect username or password")}else{putCookie("login",ret,1/12);showLogin(user)}return ret})}function showLogin(user){window.DZUser=user;var alertMessage=document.getElementById("alertMessage");var alertUser=document.getElementById("alert-user");var item=document.getElementsByClassName("navbar-item login")[0];if(item){putClass(item,"null");item.onclick=function(){}}var drop=document.getElementsByClassName("drop login")[0];drop.style.top=-1*(parseInt(style(drop,"height"))+6+40)+"px";alertUser.innerHTML=user;alertMessage.style.left="-3px";adjustSections()}function logout(){remCookie("login");initAlert();var item=document.getElementsByClassName("navbar-item login")[0];if(item){remClass(item,"null");item.onclick=function(){showDrop("login")}}try{document.getElementById("login").reset()}catch(e){}try{document.getElementById("register").reset()}catch(e){}adjustSections()}function reg_checkuser(){var user=document.getElementById("register-user");remClass(user,["good","bad"]);if(user.value!=""){new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded",{async:true}).send({method:"check",user:user.value},function(ret){if(user.value!=""){if(ret=="1"){putClass(user,"good");remClass(user,"bad")}else{putClass(user,"bad");remClass(user,"good")}}})}}var te;function checkemail(id){var email=document.getElementById(id);if(te){clearTimeout(te)}remClass(email,["good","bad"]);if(email.value!=""){if(emailRegexPattern.test(email.value)){new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded",{async:true}).send({method:"check",email:email.value},function(ret){if(email.value!=""){if(ret=="1"){putClass(email,"good");remClass(email,"bad")}else{putClass(email,"bad");remClass(email,"good")}}})}else{te=setTimeout(function(){putClass(email,"bad");remClass(email,"good")},1000)}}}var tp;function checkpass(passId,pass2Id){var pass=document.getElementById(passId);var pass2=document.getElementById(pass2Id);if(tp){clearTimeout(tp)}remClass([pass,pass2],"good");remClass([pass,pass2],"bad");if(pass.value!=""&&pass2.value!=""){if(pass.value!=pass2.value){tp=setTimeout(function(){putClass(pass2,"bad");remClass(pass2,"good")},1000)}else{putClass([pass,pass2],"good");remClass([pass,pass2],"bad")}}}function checkCaps(e,passId,pass2Id){e=e||window.event;var code=e.charCode;var shift=e.shiftKey;var on=(code>=97&&code<=122&&shift)||(code>=65&&code<=90&&!shift);var args=arguments;for(var i=1;i<args.length;i++){var el=typeof args[i]==Element?args[i]:document.getElementById(args[i]);if(on){el.setAttribute("title","CAPS LOCK");putClass(el,"warning")}else{el.setAttribute("title","");remClass(el,"warning")}}}function register(){var user=document.getElementById("register-user").value;var email=document.getElementById("register-email").value;var pass=document.getElementById("register-pass").value;var pass2=document.getElementById("register-pass2").value;var agree=document.getElementById("register-agree").checked;var submit=document.getElementById("register-submit");if(!agree){alert("Please confirm that you agree to the privacy policy");return false}if(user!=""&&email!=""&&pass!=""&&pass2!=""&&pass==pass2&&emailRegexPattern.test(email)){new AjaxRequest("/php/manage-login.php","get","application/x-www-form-urlencoded").send({method:"register",user:user,email:email,pass:Sha256.hash(pass)},function(ret){if(parseInt(ret)==1){submit.value="Account successfully created.  Check your email to confirm your email address.";var drop=document.getElementsByClassName("drop register")[0];drop.style.top=-1*(parseInt(style(drop,"height"))+6+40)+"px";adjustSections();login(user,Sha256.hash(pass));submit.disabled=true;alert("Check your email to validate your email address before continuing.\n\nIf you do not click the confirmation link, your account will be automatically deleted after three days.")}else{alert("Something is wrong. Make sure all your information is entered correctly.\nError ("+ret+")")}})}else{alert("Something went wrong. Make sure all your information is entered correctly.")}return false}function bugSubmit(form){var reportType=form.reportType.value;var email=form.email.value;if(email!=""&&!emailRegexPattern.test(email)){alert("Sorry. That's not a valid email address");return false}var desc=form.description.value;if(desc==""){alert("Whoops. Look like you forgot to include the problem!");return false}var submit=form[2];putClass(submit,"sending");new AjaxRequest("/php/manage-report.php","post","application/x-www-form-urlencoded",{async:true}).send({email:email,desc:desc,type:reportType},function(ret){if(parseInt(ret)<0){alert("There was a problem processing your report.")}else{alert("Report submitted! Thank you for your help!");remClass(submit,"sending");showDrop()}});return false}function forgotSubmit(form){var email=form.email.value;if(email!=""&&!emailRegexPattern.test(email)){alert("Sorry. That's not a valid email address");return false}var submit=form[1];putClass(submit,"sending");new AjaxRequest("/php/manage-password.php","post","application/x-www-form-urlencoded",{async:true}).send({email:email,method:"send-reset"},function(ret){remClass(submit,"sending");if(parseInt(ret)<0){alert("Email address not registered to an account.")}else{alert("Check your email for how to reset your password");showDrop()}});return false}function showDrop(name){var drops=document.getElementsByClassName("drop");var dropContainer=document.getElementById("drop-container");for(var i=0;i<drops.length;i++){var drop=drops[i];if(hasClass(drop,name)){var input=drop.getElementsByTagName("input")[0];if(input){input.focus()}drop.style.top="-3px";adjustSections(drop)}else{drop.style.top=-1*(parseInt(style(drop,"height"))+6+40)+"px"}}if(!name){adjustSections()}}window.alert=(function(orig){var stylesheet=genEl("style",{type:"text/css"},{},"	#customAlertBackground, #customAlertBody{ 		transition: all .25s linear; 		-moz-transition: all .25s linear; 		-o-transition: all .25s linear; 		-webkit-transition: all .25s linear; 	} 	#customAlertBackground{ 		display: table; 		background: rgba(0,0,0,.6); 		width: 100%; 		height: 100%; 		position: fixed; 		top: 0; 		left: 0; 		text-align: center; 		opacity: 0; 		visibility: hidden; 	} 	#customAlertBackground.show{ 		opacity: 1; 		visibility: visible; 	} 	#customAlertHolder{ 		display: table-cell; 		vertical-align: middle; 	} 	#customAlertHeader{ 		text-align: left; 		display: block; 		font-size: 24px; 		padding: 10px; 		border-bottom-width: 2px; 		border-radius: 3px 3px 0 0; 		-moz-border-radius: 3px 3px 0 0; 		-o-border-radius: 3px 3px 0 0; 		-webkit-border-radius: 3px 3px 0 0; 	}	#customAlertBody{ 		display: inline-block; 		max-width: 600px; 		max-height: 100%; 		min-width: 200px; 		min-height: 200px; 		background: #fff; 		text-align: left; 		box-shadow: 0 0 10px #fff; 		font-size: 20px; 		font-weight: normal; 		position: relative 	} 	#customAlertHeader, #customAlertClose{ 		color: #000; 		background: #f2f2f2; 		border: 0 solid #bbb; 		font-weight: bold; 		box-sizing: border-box; 		-moz-box-sizing: border-box; 		-o-box-sizing: border-box; 		-webkit-box-sizing: border-box; 		box-shadow: 0 0 15px #000; 	} 	#customAlertClose{ 		border-top-width: 1px; 		display: inline-block; 		width: 100%; 		height: 33px; 		text-align: center; 		padding: 5px; 		-moz-border-radius: 0 0 3px 3px; 		-o-border-radius: 0 0 3px 3px; 		-webkit-border-radius: 0 0 3px 3px; 		cursor: pointer; 		position: absolute; 		bottom: 0; 				transition: all .25s linear; 		-moz-transition: all .25s linear; 		-o-transition: all .25s linear; 		-webkit-transition: all .25s linear; 	} 	#customAlertClose:hover{ 		background: #eaeaea; 	} 	#customAlertClose:active{ 		background: #ddd; 				transition: all .0 linear; 		-moz-transition: all 0 linear; 		-o-transition: all 0 linear; 		-webkit-transition: all 0 linear; 	} 	#customAlertContentWrapper{ 		max-height: 100%; 		overflow: hidden; 		padding-bottom: 33px; /*Same as close height*/ 	} 	#customAlertContent{ 		padding: 16px 14px; 		max-height: 100%; 		overflow: auto; 	} 	");document.head.appendChild(stylesheet);function closeAlert(){remClass(alertBackground,"show");queue.unblock();if(previousFocus){previousFocus.focus();setTimeout(function(){if(document.activeElement==previousFocus){previousFocus=null}},500)}}var alertBackground=genEl("div",{id:"customAlertBackground",tabIndex:"-1"});alertBackground.addEventListener("keydown",function(e){if(e.keyCode==27){closeAlert()}});alertBackground.addEventListener("keypress",function(e){if(e.keyCode==13){closeAlert()}});var setPreviousFocus=function(){if(document.activeElement!=alertBackground&&document.activeElement!=document.body){previousFocus=document.activeElement}};var alertHolder=genEl("div",{id:"customAlertHolder"});var alertBody=genEl("div",{id:"customAlertBody"});var alertHeader=genEl("div",{id:"customAlertHeader"},{},"Dramatic Zoom");var alertContentWrapper=genEl("div",{id:"customAlertContentWrapper"});var alertContent=genEl("div",{id:"customAlertContent"});var alertClose=genEl("div",{id:"customAlertClose"},{},"Close");var previousFocus;alertBackground.appendChild(alertHolder);alertHolder.appendChild(alertBody);alertBody.appendChild(alertHeader);alertContentWrapper.appendChild(alertContent);alertBody.appendChild(alertContentWrapper);alertBody.appendChild(alertClose);window.addEventListener("load",function(){document.body.appendChild(alertBackground)});alertBody.addEventListener("click",function(e){e.stopPropagation()},false);alertBackground.addEventListener("click",closeAlert);alertClose.addEventListener("click",closeAlert);alertBackground.addEventListener("blur",function(){setTimeout(function(){setPreviousFocus()},8);if(hasClass(alertBackground,"show")){setTimeout(function(){alertBackground.focus()},10)}});var queue=new BlockingQueue();return function(arg){queue.add(function(){if(arg===undefined){arg=""}arg=escapeHTML(arg).replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/\n/g,"<br />");alertContent.innerHTML=arg;putClass(alertBackground,"show");setPreviousFocus();if(previousFocus){previousFocus.blur()}var focusInterval=setInterval(function(){if(alertBackground!=document.activeElement){alertBackground.focus()}else{clearInterval(focusInterval)}},1)})}})(window.alert);